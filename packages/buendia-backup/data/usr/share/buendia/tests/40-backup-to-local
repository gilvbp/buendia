BUENDIA_TEST_BACKUP_TARGET=/var/backups/buendia/backup.$(date +%Y-%m-%d)

# When the backup cron job runs
test_10_run_backup_cron () {
    rm -rf $BUENDIA_TEST_BACK_TARGET
    # TODO Right now this fails when UTILS_TEST_PHYSICAL_BACKUP is set, because
    # the code sees the inserted USB disk and cries :( but we're not even
    # testing restore right now. So just return success.
    #
    # ++ buendia-log buendia-restore /dev/sdb1
    # 2019-08-31 16:35:05 25852> (start) buendia-restore /dev/sdb1
    # 2019-08-31 16:35:05 25852> /dev/sdb1 is a block device; mounting...
    # 2019-08-31 16:35:05 25852> /mnt/buendia-restore.25861.sdb1/restore does not exist, exiting.
    # 2019-08-31 16:35:05 25852> (end, status 1)
    execute_cron_right_now backup || true
}

# Then it stores a tarball of site configs locally
test_20_cron_saved_site_config () {
    tar tfz $BUENDIA_TEST_BACKUP_TARGET/buendia.tar.gz
}

# And it stores a database dump locally
test_20_cron_saved_database_dump () {
    unzip -t $BUENDIA_TEST_BACKUP_TARGET/openmrs.zip
}

test_20_cron_saved_package_list () {
    [ -s $BUENDIA_TEST_BACKUP_TARGET/buendia.list ]
}
